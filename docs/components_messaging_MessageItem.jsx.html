<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/messaging/MessageItem.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/messaging/MessageItem.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useRef, useEffect } from 'react';
import { format } from 'date-fns'; 
import { BsThreeDotsVertical } from 'react-icons/bs'; 
import { FiTrash2, FiEdit2 } from 'react-icons/fi'; 
const MessageItem = ({ message, isOwnMessage, senderInfo, showReadReceipt,onDeleteMessage,onUpdateMessage }) => {
  const defaultAvatar = '/Images/user.svg';
  const [menuOpen, setMenuOpen] = useState(false);
  const [isEditing, setIsEditing] = useState(false);
  const [editedText, setEditedText] = useState(message.text || ''); // Initialize with current text
  const menuRef = useRef(null);
  const inputRef = useRef(null);

    // --- Menu Handling ---
    useEffect(() => {
      const handleClickOutside = (e) => {
        if (menuRef.current &amp;&amp; !menuRef.current.contains(e.target)) {
          setMenuOpen(false);
        }
      };
      if (menuOpen) document.addEventListener('mousedown', handleClickOutside);
      else document.removeEventListener('mousedown', handleClickOutside);
      return () => document.removeEventListener('mousedown', handleClickOutside);
    }, [menuOpen]);
  
    const handleMenuToggle = (e) => {
      e.stopPropagation();
      setMenuOpen(!menuOpen);
    };
  
    // --- Delete Handling ---
    const handleDelete = (e) => {
      e.stopPropagation();
      // Optional: Add a confirmation dialog here
      if (window.confirm('Are you sure you want to delete this message?')) {
          onDeleteMessage(message.id);
      }
      setMenuOpen(false);
    };
  
    // --- Edit Handling ---
    const handleEdit = (e) => {
      e.stopPropagation();
      setIsEditing(true);
      setEditedText(message.text || ''); // Reset edit text to original on edit start
      setMenuOpen(false);
      // Focus the input shortly after it appears
      setTimeout(() => inputRef.current?.focus(), 50);
    };
  
    const handleCancelEdit = (e) => {
      e.stopPropagation();
      setIsEditing(false);
      
    };
  
    const handleSaveEdit = (e) => {
      e.stopPropagation();
      if (editedText.trim() === message.text?.trim()) {
          // No actual change, just cancel edit mode
          setIsEditing(false);
          return;
      }
      if (editedText.trim()) { // Don't save empty messages
          onUpdateMessage(message.id, editedText.trim());
          setIsEditing(false);
      } else {
          // If user cleared text, treat as delete or cancel?
          // For now, let's just cancel edit mode. Deleting should use the Delete button.
          setIsEditing(false);
          // Or maybe delete if text is empty?
          // if (window.confirm('Remove message text? This cannot be undone.')) {
          //    onUpdateMessage(message.id, ''); // Update with empty string
          //    setIsEditing(false);
          // }
      }
    };
  
    // Handle Enter key press in edit input to save
    const handleEditKeyDown = (e) => {
        if (e.key === 'Enter' &amp;&amp; !e.shiftKey) { // Save on Enter (not Shift+Enter)
            e.preventDefault();
            handleSaveEdit();
        } else if (e.key === 'Escape') { // Cancel on Escape
            handleCancelEdit();
        }
    };

  /**
   * Renders media content based on the type of media provided in the `message` object.
   * 
   * @returns {JSX.Element|null} A JSX element representing the media content or a link to the media,
   *                             or null if no media URL is provided.
   * 
   * The function handles the following media types:
   * - Images: Renders an &lt;img> element for media types starting with "image/".
   * - Videos: Renders a &lt;video> element for media types starting with "video/".
   * - Other files: Renders an &lt;a> element linking to the media file.
   * 
   * The rendered elements include appropriate styling and accessibility attributes.
   */
  const renderMedia = () => {
    if (!message.mediaUrl || message.mediaUrl.length === 0) {
      return ;
    }
  
    return (
      &lt;div className="flex flex-col gap-4 items-center">
        {message.mediaUrl.map((url, index) => {
          if (url.includes("image")) {
            return (
              &lt;div key={index} className="relative group w-full max-w-sm">
                &lt;img
                  src={url}
                  alt={`Uploaded content ${index + 1}`}
                  className="w-40 h-40 rounded-lg shadow-lg transition-transform transform group-hover:scale-105 cursor-pointer"
                  onClick={() => window.open(url, "_blank")}
                />
                
              &lt;/div>
            );
          } else if (url.includes("video")) {
            return (
              &lt;div key={index} className="w-full max-w-sm">
                &lt;video
                  src={url}
                  controls
                  className="w-40 h-40 rounded-lg shadow-lg transition-transform transform hover:scale-105"
                />
              &lt;/div>
            );
          } else {
            return (
              &lt;div
                key={index}
                className="p-4 mt-2  rounded-lg bg-gray-100 cursor-pointer hover:bg-gray-200  w-full max-w-sm text-center"
                onClick={() => window.open(url, "_blank")}
              >
                &lt;p className="text-blue-500 font-medium">ðŸ“„ Click to open document&lt;/p>
              &lt;/div>
            );
          }
        })}
      &lt;/div>
    );
  };
// --- Timestamp Formatting ---
const formatTimestamp = (ts) => {
  return ts ? format(ts.toDate(), 'p') : 'Sending...';
}

return (
// Add group class for hover effect on menu button
&lt;div className={`group flex gap-2 my-1 ${isOwnMessage ? 'justify-end' : 'justify-start'}`}>
  {/* Avatar (only for other messages) */}
  {!isOwnMessage &amp;&amp; (
    &lt;img
      src={senderInfo?.profilePicture || defaultAvatar}
      alt={senderInfo?.fullName || 'Sender'}
      className="w-8 h-8 rounded-full flex-shrink-0 self-end mb-1" // Align bottom
    />
  )}
     {/* Ellipsis Menu (only for own messages and not editing) */}
     {isOwnMessage &amp;&amp; !isEditing &amp;&amp; !message.isDeleted &amp;&amp; (
       &lt;div className="relative self-center mr-1" ref={menuRef}>
           {/* Show button on group hover */}
           &lt;button
               onClick={handleMenuToggle}
               // Use opacity for hover effect, more accessible than display:none
               className=" text-gray-400 hover:text-gray-600 rounded-full opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity"
               aria-label="Message options"
               aria-haspopup="true"
               aria-expanded={menuOpen}
           >
               &lt;BsThreeDotsVertical className="h-4 w-4" />
           &lt;/button>

           {/* Dropdown Menu */}
           {menuOpen &amp;&amp; (
               &lt;div
                   className="absolute  right-0 bottom-0 mt-1 w-32 bg-white rounded-md shadow-lg border z-20"
                   role="menu" aria-orientation="vertical"
               >
                   &lt;div className="py-1" role="none">
                       {/* Edit Button - Disable if message has media? Or allow text edit only? */}
                       &lt;button
                           onClick={handleEdit}
                           className="w-full text-left flex items-center px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"
                           role="menuitem" tabIndex={-1}
                       >
                           &lt;FiEdit2 className="mr-2 h-4 w-4 text-gray-500" aria-hidden="true" />
                           Edit
                       &lt;/button>
                       {/* Delete Button */}
                       &lt;button
                           onClick={handleDelete}
                           className="w-full text-left flex items-center px-3 py-1.5 text-sm text-red-600 hover:bg-gray-100 hover:text-red-700"
                           role="menuitem" tabIndex={-1}
                       >
                           &lt;FiTrash2 className="mr-2 h-4 w-4" aria-hidden="true" />
                           Delete
                       &lt;/button>
                   &lt;/div>
               &lt;/div>
           )}
       &lt;/div>
   )}

  {/* Message Bubble and Content Area */}
  &lt;div className={`relative flex flex-col ${isOwnMessage ? 'items-end' : 'items-start'}`}>
     {/* Bubble styling */}
     &lt;div
       className={`relative max-w-md lg:max-w-lg px-3 py-2 rounded-lg bg-gray-200 text-gray-800 ${
         isOwnMessage
           ? ' rounded-br-none'
           : ' rounded-bl-none'
       }`}
     >
       
       {!isOwnMessage &amp;&amp; senderInfo &amp;&amp; (
          &lt;p className="text-xs font-semibold mb-1 text-gray-700">{senderInfo.fullName}&lt;/p>
        )}

       {/* Message Content (Editing or Display) */}
       {isEditing ? (
           &lt;div className="flex flex-col">
               &lt;textarea
                   ref={inputRef}
                   value={editedText}
                   onChange={(e) => setEditedText(e.target.value)}
                   onKeyDown={handleEditKeyDown}
                   className={`w-full p-1  rounded text-white-600 focus:outline-none  focus:ring-blue-300 resize-none overflow-hidden min-h-[40px] text-sm`}
                   rows={Math.max(1, Math.min(5, editedText.split('\n').length))} // Auto-resize roughly
                   aria-label="Edit message"
               />
               &lt;div className="flex justify-end gap-2 mt-1 text-xs">
                   &lt;button onClick={handleCancelEdit} className="text-white-600 hover:underline font-medium">Cancel&lt;/button>
                   &lt;button onClick={handleSaveEdit} className="text-white-600 hover:underline font-medium">Save&lt;/button>
               &lt;/div>
           &lt;/div>
       ) : (
           &lt;>
               {/* Display Text (if not just media) */}
               {message.text &amp;&amp; &lt;p className="whitespace-pre-wrap break-words">{message.text}&lt;/p>}
               {/* Display Media */}
               {renderMedia()}
               {/* Timestamp and Edited Status */}
               &lt;div className={`text-xs mt-1 flex items-center justify-end gap-1 text-gray-500`}>
                   {message.editedAt &amp;&amp; &lt;span className="italic text-xs">(edited)&lt;/span>}
                   &lt;span>{formatTimestamp(message.timestamp)}&lt;/span>
               &lt;/div>
           &lt;/>
       )}
     &lt;/div>

     {/* Read Receipt (only for own messages) */}
     {isOwnMessage &amp;&amp; showReadReceipt &amp;&amp; !isEditing &amp;&amp; (
       &lt;p className="text-xs text-gray-500 mt-0.5 mr-1">Read&lt;/p>
     )}
     {isOwnMessage &amp;&amp; !showReadReceipt &amp;&amp; !isEditing &amp;&amp; (
       &lt;p className="text-xs text-gray-500 mt-0.5 mr-1">Sent&lt;/p>
     )}
  &lt;/div>

  {/* Spacer for own messages to align left content */}
  {isOwnMessage &amp;&amp; &lt;div className="w-8 flex-shrink-0">&lt;/div>}

&lt;/div>
);
};

export default MessageItem;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ChatWindow">ChatWindow</a></li><li><a href="global.html#CommentSection">CommentSection</a></li><li><a href="global.html#ConversationListItem">ConversationListItem</a></li><li><a href="global.html#ConversationSearch">ConversationSearch</a></li><li><a href="global.html#CreatePostModal">CreatePostModal</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#HirePage">HirePage</a></li><li><a href="global.html#JobBoardPage">JobBoardPage</a></li><li><a href="global.html#JobDetails">JobDetails</a></li><li><a href="global.html#Jobs">Jobs</a></li><li><a href="global.html#Main">Main</a></li><li><a href="global.html#ManageJob">ManageJob</a></li><li><a href="global.html#MyJobs">MyJobs</a></li><li><a href="global.html#Notification">Notification</a></li><li><a href="global.html#NotificationCard">NotificationCard</a></li><li><a href="global.html#PostMenu">PostMenu</a></li><li><a href="global.html#PostReactions">PostReactions</a></li><li><a href="global.html#ScreeningQuestionCard">ScreeningQuestionCard</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#fetchComments">fetchComments</a></li><li><a href="global.html#fetchNotifications">fetchNotifications</a></li><li><a href="global.html#fetchPosts">fetchPosts</a></li><li><a href="global.html#fetchUser">fetchUser</a></li><li><a href="global.html#filteredNotifications">filteredNotifications</a></li><li><a href="global.html#getReactionIcon">getReactionIcon</a></li><li><a href="global.html#handleAddComment">handleAddComment</a></li><li><a href="global.html#handleBlockUser">handleBlockUser</a></li><li><a href="global.html#handleClick">handleClick</a></li><li><a href="global.html#handleCreatePost">handleCreatePost</a></li><li><a href="global.html#handleDeleteNotification">handleDeleteNotification</a></li><li><a href="global.html#handleLikeClick">handleLikeClick</a></li><li><a href="global.html#handleMainFilterChange">handleMainFilterChange</a></li><li><a href="global.html#handleMuteDuration">handleMuteDuration</a></li><li><a href="global.html#handleNotificationClick">handleNotificationClick</a></li><li><a href="global.html#handleReact">handleReact</a></li><li><a href="global.html#handleReactToComment">handleReactToComment</a></li><li><a href="global.html#handleReportPost">handleReportPost</a></li><li><a href="global.html#handleSavePost">handleSavePost</a></li><li><a href="global.html#handleSendTestNotification">handleSendTestNotification</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#requestOTP">requestOTP</a></li><li><a href="global.html#sendMessage">sendMessage</a></li><li><a href="global.html#toggleComments">toggleComments</a></li><li><a href="global.html#verifyOTP">verifyOTP</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri May 02 2025 17:16:34 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
